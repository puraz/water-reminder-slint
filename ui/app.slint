import { Button, VerticalBox, HorizontalBox, ScrollView, LineEdit } from "std-widgets.slint";

// Timeræ˜¯å†…ç½®ç»„ä»¶ï¼Œä¸éœ€è¦import

// ================================
// æ•°æ®ç»“æ„å®šä¹‰
// ================================

export struct WaterRecord {
    id: int,
    amount: int,
    time: string,
}

// ================================
// å…¨å±€çŠ¶æ€ç®¡ç†
// ================================

export global AppState {
    in-out property <int> daily-goal: 2000;
    in-out property <int> total-today: 0;
    in-out property <float> progress-percentage: 0.0;
    in-out property <[WaterRecord]> today-records: [];
    in-out property <int> current-page: 0; // 0=ä¸»é¡µ, 1=ç»Ÿè®¡, 2=è®¾ç½®
    in-out property <bool> reminder-enabled: true;
    in-out property <int> reminder-interval: 60;
    in-out property <bool> show-custom-input: false;
    in-out property <string> custom-amount: "";
    
    // å–æ°´æç¤ºç›¸å…³
    in-out property <bool> show-success-toast: false;
    in-out property <string> toast-message: "";
    in-out property <string> toast-icon: "";
    
    // ç»Ÿè®¡æ•°æ®
    in-out property <int> weekly-average: 0;
    in-out property <int> streak-days: 0;
    in-out property <int> max-daily: 0;
    in-out property <int> total-week: 0;
    in-out property <[int]> seven-days-data: [0, 0, 0, 0, 0, 0, 0]; // 7å¤©çš„é¥®æ°´æ•°æ®ï¼Œæœ€åä¸€ä¸ªæ˜¯ä»Šå¤©
    
    callback add-water(int);
    callback undo-last-record();
    callback set-daily-goal(int);
    callback toggle-reminder(bool);
    callback set-reminder-interval(int);
    callback switch-page(int);
    callback show-custom-input-dialog();
    callback hide-custom-input-dialog();
    callback add-custom-water();
    callback hide-success-toast();
}

// ================================
// é€šç”¨ç»„ä»¶
// ================================

component WaterButton inherits Rectangle {
    in property <int> amount;
    
    width: 100px;
    height: 55px;
    background: touch-area.has-hover ? #2ecc71 : (touch-area.pressed ? #2980b9 : #3498db);
    border-radius: 16px;
    drop-shadow-color: #00000020;
    drop-shadow-blur: touch-area.pressed ? 4px : 6px;
    drop-shadow-offset-y: touch-area.pressed ? 1px : 3px;
    
    touch-area := TouchArea {
        clicked => { AppState.add-water(root.amount); }
    }
    
    VerticalBox {
        alignment: center;
        
        Text {
            text: root.amount + " ml";
            color: white;
            font-size: 18px;
            font-weight: 700;
            horizontal-alignment: center;
        }
    }
    
    animate background { duration: 200ms; }
    animate drop-shadow-offset-y { duration: 150ms; }
    animate drop-shadow-blur { duration: 150ms; }
}

component AchievementBadge inherits Rectangle {
    in property <string> icon;
    in property <string> title;
    in property <string> description;
    
    width: 130px;
    height: 100px;
    background: #f8f9fa;
    border-radius: 15px;
    border-width: 2px;
    border-color: #e9ecef;
    
    VerticalBox {
        alignment: center;
        spacing: 5px;
        
        Text {
            text: root.icon;
            font-size: 24px;
        }
        
        Text {
            text: root.title;
            font-size: 12px;
            font-weight: 600;
            color: #2c3e50;
            horizontal-alignment: center;
        }
        
        Text {
            text: root.description;
            font-size: 10px;
            color: #6c757d;
            horizontal-alignment: center;
        }
    }
}

component SettingGroup inherits VerticalBox {
    in property <string> title;
    
    spacing: 10px;
    
    Text {
        text: root.title;
        font-size: 16px;
        font-weight: 600;
        color: #2c3e50;
    }
    
    Rectangle {
        background: white;
        border-width: 1px;
        border-color: #e9ecef;
        border-radius: 10px;
        padding: 15px;
        
        @children
    }
}

// ================================
// å¯¼èˆªç»„ä»¶
// ================================

component NavButton inherits Rectangle {
    in property <string> text;
    in property <int> page-index;
    in property <bool> active;
    
    callback clicked;
    
    background: active ? #34495e : hover-area.has-hover ? #3e526b : transparent;
    border-radius: 0;
    
    hover-area := TouchArea {
        clicked => { root.clicked(); }
    }
    
    Text {
        text: root.text;
        color: white;
        font-size: 14px;
        font-weight: active ? 700 : 400;
        horizontal-alignment: center;
        vertical-alignment: center;
    }
    
    // é€‰ä¸­çŠ¶æ€çš„ç»¿è‰²æŒ‡ç¤ºæ¡
    if active: Rectangle {
        height: 3px;
        width: parent.width;
        background: #4CAF50;
        y: parent.height - self.height;
        x: 0;
    }
    
    animate background { duration: 200ms; }
}

component NavBar inherits Rectangle {
    height: 60px;
    background: #2c3e50;
    
    HorizontalBox {
        alignment: stretch;
        spacing: 0;
        padding: 0;
        
        NavButton {
            text: "ä¸»é¡µ";
            page-index: 0;
            active: AppState.current-page == 0;
            clicked => { AppState.switch-page(0); }
        }
        
        NavButton {
            text: "ç»Ÿè®¡";
            page-index: 1;
            active: AppState.current-page == 1;
            clicked => { AppState.switch-page(1); }
        }
        
        NavButton {
            text: "è®¾ç½®";
            page-index: 2;
            active: AppState.current-page == 2;
            clicked => { AppState.switch-page(2); }
        }
    }
}

// ================================
// ä¸»é¡µç»„ä»¶
// ================================

component HomePage inherits ScrollView {
    VerticalBox {
        spacing: 20px;
        padding: 10px;
    
    // ä»Šæ—¥è¿›åº¦å¡ç‰‡
    Rectangle {
        height: 160px;
        background: #667eea;
        border-radius: 15px;
        drop-shadow-color: #00000020;
        drop-shadow-blur: 10px;
        drop-shadow-offset-y: 2px;
        
        VerticalBox {
            alignment: center;
            spacing: 15px;
            
            Text {
                text: "ä»Šæ—¥é¥®æ°´é‡";
                color: white;
                font-size: 18px;
                font-weight: 600;
            }
            
            Text {
                text: AppState.total-today + " / " + AppState.daily-goal + " ml";
                color: white;
                font-size: 24px;
                font-weight: 700;
            }
            
            Rectangle {
                height: 12px;
                width: 80%;
                background: #ffffff30;
                border-radius: 8px;
                
                Rectangle {
                    width: parent.width * AppState.progress-percentage / 100;
                    height: parent.height;
                    background: #4CAF50;
                    border-radius: parent.border-radius;
                    x: 0;
                    y: 0;
                }
            }
            
            Text {
                text: Math.round(AppState.progress-percentage) + "%";
                color: white;
                font-size: 16px;
                font-weight: 500;
            }
        }
    }
    
    // å¿«é€Ÿæ·»åŠ æŒ‰é’®
    VerticalBox {
        spacing: 10px;
        
        Text {
            text: "å¿«é€Ÿæ·»åŠ ";
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        VerticalBox {
            spacing: 15px;
            
            HorizontalBox {
                alignment: space-around;
                // spacing: 8px;
                WaterButton { amount: 50; }
                WaterButton { amount: 100; }
                WaterButton { amount: 200; }
            }
            
            HorizontalBox {
                alignment: space-around;
                // spacing: 8px;
                WaterButton { amount: 300; }
                WaterButton { amount: 400; }
                WaterButton { amount: 500; }
            }
        }
        
        // è‡ªå®šä¹‰è¾“å…¥åŒºåŸŸ
        HorizontalBox {
            spacing: 15px;
            alignment: center;
            
            Button {
                text: "è‡ªå®šä¹‰é‡";
                primary: true;
                height: 45px;
                width: 120px;
                clicked => {
                    AppState.show-custom-input-dialog();
                }
            }
            
            Button {
                height: 45px;
                width: 80px;
                text: "æ’¤é”€";
                clicked => { AppState.undo-last-record(); }
            }
        }
    }
    
    // ä»Šæ—¥è®°å½•æˆ–é¼“åŠ±ä¿¡æ¯
    VerticalBox {
        spacing: 10px;
        
        Text {
            text: AppState.today-records.length > 0 ? "ä»Šæ—¥è®°å½•" : "ä»Šæ—¥çŠ¶æ€";
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        if AppState.today-records.length > 0: ScrollView {
            height: 180px;
            
            VerticalBox {
                spacing: 8px;
                for record[index] in AppState.today-records: Rectangle {
                    height: 70px;
                    background: hover-area.has-hover ? #f0f8ff : #ffffff;
                    border-radius: 12px;
                    border-width: 1px;
                    border-color: hover-area.has-hover ? #3498db : #e3f2fd;
                    drop-shadow-color: #00000010;
                    drop-shadow-blur: 6px;
                    drop-shadow-offset-y: 2px;
                    
                    hover-area := TouchArea {
                        // æ‚¬æµ®åŒºåŸŸï¼Œç”¨äºæ£€æµ‹é¼ æ ‡æ‚¬æµ®
                    }
                    
                        HorizontalBox {
                            padding-left: 8px;
                            padding-right: 8px;
                            spacing: 12px;
                            alignment: space-between;
                            
                            // å·¦ä¾§ï¼šå›¾æ ‡å’Œæ°´é‡ä¿¡æ¯
                            HorizontalBox {
                                spacing: 8px;
                                alignment: center;
                                
                                // æ°´æ»´å›¾æ ‡
                                Rectangle {
                                    width: 40px;
                                    height: 40px;
                                    background: #e8f5e8;
                                    border-radius: 20px;
                                    
                                    Text {
                                        text: "ğŸ’§";
                                        font-size: 18px;
                                        horizontal-alignment: center;
                                        vertical-alignment: center;
                                    }
                                }
                                
                                // æ°´é‡ä¿¡æ¯
                                VerticalLayout {
                                    alignment: center;
                                    // spacing: 3px;
                                    
                                    Text {
                                        text: record.amount + " ml";
                                        font-size: 16px;
                                        font-weight: 600;
                                        color: #2c3e50;
                                        horizontal-alignment: left;
                                    }
                                    
                                    Text {
                                        text: "ç¬¬ " + (AppState.today-records.length - index) + " æ¬¡è®°å½•";
                                        font-size: 12px;
                                        color: #6c757d;
                                        horizontal-alignment: left;
                                    }
                                }
                            }
                            
                            // å³ä¾§ï¼šæ—¶é—´
                            Text {
                                text: record.time;
                                font-size: 14px;
                                color: #6c757d;
                                horizontal-alignment: right;
                                vertical-alignment: center;
                            }
                        }
                    
                    animate background { duration: 200ms; }
                    animate border-color { duration: 200ms; }
                }
            }
        }
        
        if AppState.today-records.length == 0: VerticalBox {
            spacing: 15px;
            
            // é¼“åŠ±å¡ç‰‡
            Rectangle {
                height: 100px;
                background: #e8f5e8;
                border-radius: 12px;
                border-width: 2px;
                border-color: #4CAF50;
                
                VerticalBox {
                    alignment: center;
                    spacing: 8px;
                    
                    Text {
                        text: "ğŸ’ª å¼€å§‹ä»Šæ—¥é¥®æ°´ä¹‹æ—…ï¼";
                        font-size: 16px;
                        font-weight: 600;
                        color: #2e7d32;
                        horizontal-alignment: center;
                    }
                    
                    Text {
                        text: "ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è®°å½•ç¬¬ä¸€æ¯æ°´";
                        font-size: 14px;
                        color: #388e3c;
                        horizontal-alignment: center;
                    }
                }
            }
            
            // å¥åº·å°è´´å£«
            Rectangle {
                height: 120px;
                background: #f0f8ff;
                border-radius: 12px;
                border-width: 1px;
                border-color: #3498db;
                
                VerticalBox {
                    alignment: center;
                    spacing: 8px;
                    padding: 10px;
                    
                    Text {
                        text: "ğŸ’¡ é¥®æ°´å°è´´å£«";
                        font-size: 14px;
                        font-weight: 600;
                        color: #2980b9;
                        horizontal-alignment: center;
                    }
                    
                    Text {
                        text: "â€¢ æ—©æ™¨é†’æ¥åå…ˆå–ä¸€æ¯æ¸©æ°´\nâ€¢ é¥­å‰30åˆ†é’Ÿé€‚é‡é¥®æ°´æœ‰åŠ©æ¶ˆåŒ–\nâ€¢ è¿åŠ¨æ—¶è¦åŠæ—¶è¡¥å……æ°´åˆ†";
                        font-size: 12px;
                        color: #34495e;
                        horizontal-alignment: center;
                        wrap: word-wrap;
                    }
                }
            }
        }
    }
    }
}

// ================================
// ç»Ÿè®¡é¡µé¢ç»„ä»¶
// ================================

component StatsPage inherits ScrollView {
    VerticalBox {
        spacing: 20px;
        padding: 20px;
    
    // ä»Šæ—¥ç»Ÿè®¡å¡ç‰‡
    Rectangle {
        height: 120px;
        background: #667eea;
        border-radius: 15px;
        drop-shadow-color: #00000020;
        drop-shadow-blur: 10px;
        drop-shadow-offset-y: 2px;
        
        VerticalBox {
            alignment: center;
            spacing: 8px;
            
            Text {
                text: "ä»Šæ—¥è¿›åº¦";
                color: white;
                font-size: 16px;
                font-weight: 600;
            }
            
            Text {
                text: AppState.total-today + " / " + AppState.daily-goal + " ml";
                color: white;
                font-size: 20px;
                font-weight: 700;
            }
            
            Text {
                text: Math.round(AppState.progress-percentage) + "% å®Œæˆ";
                color: white;
                font-size: 14px;
            }
        }
    }
    
    // å‘¨ç»Ÿè®¡å¡ç‰‡
    Rectangle {
        height: 160px;
        background: #f093fb;
        border-radius: 15px;
        drop-shadow-color: #00000020;
        drop-shadow-blur: 10px;
        drop-shadow-offset-y: 2px;
        
        VerticalBox {
            alignment: center;
            spacing: 5px;
            
            Text {
                text: "æœ¬å‘¨ç»Ÿè®¡";
                color: white;
                font-size: 16px;
                font-weight: 600;
            }
            
            HorizontalBox {
                spacing: 30px;
                alignment: center;
                
                VerticalBox {
                    alignment: center;
                    spacing: 5px;
                    
                    Text {
                        text: AppState.weekly-average + " ml";
                        color: white;
                        font-size: 18px;
                        font-weight: 700;
                    }
                    
                    Text {
                        text: "æ—¥å‡é¥®æ°´";
                        color: white;
                        font-size: 12px;
                    }
                }
                
                VerticalBox {
                    alignment: center;
                    spacing: 5px;
                    
                    Text {
                        text: AppState.total-week + " ml";
                        color: white;
                        font-size: 18px;
                        font-weight: 700;
                    }
                    
                    Text {
                        text: "æœ¬å‘¨æ€»é‡";
                        color: white;
                        font-size: 12px;
                    }
                }
            }
            
            Text {
                text: "è¿ç»­è¾¾æ ‡: " + AppState.streak-days + " å¤©";
                color: white;
                font-size: 14px;
            }
        }
    }
    
    // ä¸ªäººè®°å½•å¡ç‰‡
    Rectangle {
        height: 120px;
        background: #4ecdc4;
        border-radius: 15px;
        drop-shadow-color: #00000020;
        drop-shadow-blur: 10px;
        drop-shadow-offset-y: 2px;
        
        VerticalBox {
            alignment: center;
            spacing: 10px;
            
            Text {
                text: "ä¸ªäººè®°å½•";
                color: white;
                font-size: 16px;
                font-weight: 600;
            }
            
            Text {
                text: AppState.max-daily + " ml";
                color: white;
                font-size: 22px;
                font-weight: 700;
            }
            
            Text {
                text: "å•æ—¥æœ€é«˜é¥®æ°´é‡";
                color: white;
                font-size: 14px;
            }
        }
    }
    
    // ç®€åŒ–çš„7å¤©è¶‹åŠ¿
    Rectangle {
        height: 215px; // å¢åŠ é«˜åº¦ä»¥å®¹çº³æ›´é«˜çš„æŸ±çŠ¶å›¾
        background: white;
        border-width: 2px;
        border-color: #e9ecef;
        border-radius: 15px;
        
        VerticalBox {
            padding: 15px;
            spacing: 15px;
            
            Text {
                text: "ğŸ“Š è¿‘7å¤©é¥®æ°´è¶‹åŠ¿";
                font-size: 16px;
                font-weight: 600;
                color: #2c3e50;
                horizontal-alignment: center;
            }
            
            HorizontalBox {
                spacing: 8px;
                alignment: center;
                
                for i in [0, 1, 2, 3, 4, 5, 6]: Rectangle {
                    width: 35px;
                    height: 100px; // å¢åŠ é«˜åº¦ä»¥å®¹çº³æ–‡å­—
                    background: #f8f9fa;
                    border-radius: 5px;
                    border-width: 1px;
                    border-color: #e9ecef;
                    
                    VerticalBox {
                        alignment: end;
                        padding: 3px;
                        spacing: 2px;
                        
                        Rectangle {
                            width: parent.width - 6px;
                            height: AppState.seven-days-data[i] > 0 ? Math.max(5px, AppState.seven-days-data[i] * 70px / AppState.daily-goal) : 5px; // è°ƒæ•´æœ€å¤§é«˜åº¦
                            background: i == 6 ? #667eea : (AppState.seven-days-data[i] >= AppState.daily-goal ? #4CAF50 : #3498db);
                            border-radius: 3px;
                        }
                        
                        Text {
                            text: {
                                // è®¡ç®—å½“å‰æ˜¯æ˜ŸæœŸå‡  (0=å‘¨æ—¥, 1=å‘¨ä¸€, ..., 6=å‘¨å…­)
                                // å‡è®¾æ•°ç»„æœ€åä¸€ä½(ç´¢å¼•6)æ˜¯ä»Šå¤©ï¼Œå‰é¢6ä½æ˜¯è¿‡å»6å¤©
                                // éœ€è¦æ ¹æ®ä»Šå¤©æ˜¯æ˜ŸæœŸå‡ æ¥åŠ¨æ€æ˜¾ç¤ºæ ‡ç­¾
                                if i == 6 {
                                    "ä»Š"
                                } else {
                                    // ç®€åŒ–å¤„ç†ï¼šæ˜¾ç¤ºç›¸å¯¹å¤©æ•°
                                    i == 0 ? "6å¤©å‰" : i == 1 ? "5å¤©å‰" : i == 2 ? "4å¤©å‰" : 
                                    i == 3 ? "3å¤©å‰" : i == 4 ? "2å¤©å‰" : "æ˜¨å¤©"
                                }
                            };
                            font-size: 9px;
                            color: #6c757d;
                            horizontal-alignment: center;
                        }
                    }
                }
            }
            
            Text {
                text: "\"ä»Š\"è¡¨ç¤ºä»Šæ—¥è¿›åº¦";
                font-size: 12px;
                color: #6c757d;
                horizontal-alignment: center;
            }
        }
    }
    
    // æˆå°±åŒºåŸŸ
    Text {
        text: "æˆå°±å¾½ç« ";
        font-size: 16px;
        font-weight: 600;
        color: #2c3e50;
    }
    
    VerticalBox {
        spacing: 10px;
        
        HorizontalBox {
            spacing: 15px;
            alignment: center;
            
            AchievementBadge {
                icon: AppState.streak-days >= 7 ? "ğŸ†" : "ğŸ¥‰";
                title: "åšæŒè¾¾äºº";
                description: AppState.streak-days >= 7 ? "è¿ç»­" + AppState.streak-days + "å¤©è¾¾æ ‡" : "ç»§ç»­åŠªåŠ›";
            }
            
            AchievementBadge {
                icon: AppState.max-daily >= 3000 ? "ğŸ’§" : "ğŸš°";
                title: "æ°´åˆ†å¤§å¸ˆ";
                description: AppState.max-daily >= 3000 ? "å•æ—¥" + AppState.max-daily + "ml" : "å•æ—¥" + AppState.max-daily + "ml";
            }
        }
        
        HorizontalBox {
            spacing: 15px;
            alignment: center;
            
            AchievementBadge {
                icon: AppState.total-week >= 14000 ? "â­" : "ğŸŒŸ";
                title: "å‘¨ç›®æ ‡ç‹";
                description: AppState.total-week >= 14000 ? "æœ¬å‘¨" + AppState.total-week + "ml" : "æœ¬å‘¨" + AppState.total-week + "ml";
            }
            
            AchievementBadge {
                icon: AppState.progress-percentage >= 100 ? "âœ…" : "ğŸ“ˆ";
                title: "ä»Šæ—¥å®Œæˆ";
                description: AppState.progress-percentage >= 100 ? "ä»Šæ—¥å·²è¾¾æ ‡" : Math.round(AppState.progress-percentage) + "% å®Œæˆ";
            }
        }
    }
    }
}

// ================================
// è®¾ç½®é¡µé¢ç»„ä»¶
// ================================

component SettingsPage inherits VerticalBox {
    spacing: 20px;
    padding: 20px;
    
    // æ¯æ—¥ç›®æ ‡è®¾ç½®
    SettingGroup {
        title: "æ¯æ—¥ç›®æ ‡";
        
        HorizontalBox {
            spacing: 10px;
            alignment: space-between;
            
            Text {
                text: "ç›®æ ‡æ°´é‡:";
                font-size: 14px;
                color: #2c3e50;
                vertical-alignment: center;
            }
            
            HorizontalBox {
                spacing: 5px;
                
                Button {
                    text: "-";
                    width: 30px;
                    height: 30px;
                    clicked => {
                        if AppState.daily-goal > 1000 {
                            AppState.set-daily-goal(AppState.daily-goal - 100);
                        }
                    }
                }
                
                Text {
                    text: AppState.daily-goal + " ml";
                    font-size: 14px;
                    color: #2c3e50;
                    width: 80px;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
                
                Button {
                    text: "+";
                    width: 30px;
                    height: 30px;
                    clicked => {
                        if AppState.daily-goal < 5000 {
                            AppState.set-daily-goal(AppState.daily-goal + 100);
                        }
                    }
                }
            }
        }
    }
    
    // æé†’è®¾ç½®
    SettingGroup {
        title: "æé†’è®¾ç½®";
        
        VerticalBox {
            spacing: 15px;
            
            HorizontalBox {
                spacing: 10px;
                alignment: space-between;
                
                Text {
                    text: "å¯ç”¨æé†’:";
                    font-size: 14px;
                    color: #2c3e50;
                    vertical-alignment: center;
                }
                
                Button {
                    text: AppState.reminder-enabled ? "å¼€å¯" : "å…³é—­";
                    primary: AppState.reminder-enabled;
                    clicked => {
                        AppState.toggle-reminder(!AppState.reminder-enabled);
                    }
                }
            }
            
            if AppState.reminder-enabled: HorizontalBox {
                spacing: 10px;
                alignment: space-between;
                
                Text {
                    text: "æé†’é—´éš”:";
                    font-size: 14px;
                    color: #2c3e50;
                    vertical-alignment: center;
                }
                
                HorizontalBox {
                    spacing: 5px;
                    
                    Button {
                        text: "-";
                        width: 30px;
                        height: 30px;
                        clicked => {
                            if AppState.reminder-interval > 5 {
                                AppState.set-reminder-interval(AppState.reminder-interval - 5);
                            }
                        }
                    }
                    
                    Text {
                        text: AppState.reminder-interval + " åˆ†é’Ÿ";
                        font-size: 14px;
                        color: #2c3e50;
                        width: 80px;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                    
                    Button {
                        text: "+";
                        width: 30px;
                        height: 30px;
                        clicked => {
                            if AppState.reminder-interval < 120 {
                                AppState.set-reminder-interval(AppState.reminder-interval + 5);
                            }
                        }
                    }
                }
            }
        }
    }
    
    // å…³äºä¿¡æ¯
    SettingGroup {
        title: "å…³äº";
        
        VerticalBox {
            spacing: 10px;
            
            Text {
                text: "ğŸ’§ Water Reminder v0.1.0";
                font-size: 14px;
                color: #2c3e50;
                horizontal-alignment: center;
            }
            
            Text {
                text: "è·¨å¹³å°æ¡Œé¢é¥®æ°´æé†’åº”ç”¨";
                font-size: 12px;
                color: #6c757d;
                horizontal-alignment: center;
            }
            
            Text {
                text: "æ”¯æŒ Linux â€¢ Windows â€¢ macOS åŸç”Ÿé€šçŸ¥";
                font-size: 12px;
                color: #6c757d;
                horizontal-alignment: center;
                wrap: word-wrap;
            }
        }
    }
}

// ================================
// å¯¹è¯æ¡†ç»„ä»¶
// ================================

component SuccessToast inherits Rectangle {
    width: 280px;
    height: 80px;
    background: #ffffff;
    border-radius: 12px;
    border-width: 1px;
    border-color: #4CAF50;
    drop-shadow-color: #00000025;
    drop-shadow-blur: 15px;
    drop-shadow-offset-y: 5px;
    
    // 1.5ç§’åè‡ªåŠ¨éšè—
    hide-timer := Timer {
        interval: 1500ms;
        running: true;
        triggered => {
            AppState.hide-success-toast();
        }
    }
    
    HorizontalBox {
        padding: 15px;
        spacing: 12px;
        alignment: start;
        
        Rectangle {
            width: 40px;
            height: 40px;
            background: #e8f5e8;
            border-radius: 20px;
            
            Text {
                text: AppState.toast-icon;
                font-size: 20px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
        
        VerticalLayout {
            alignment: center;
            spacing: 2px;
            
            Text {
                text: AppState.toast-message;
                font-size: 16px;
                font-weight: 600;
                color: #2e7d32;
                wrap: word-wrap;
            }
            
            Text {
                text: "ç»§ç»­ä¿æŒï¼";
                font-size: 13px;
                color: #388e3c;
            }
        }
    }
    
    animate y {
        duration: 300ms;
        easing: ease-out;
    }
    
    animate opacity {
        duration: 300ms;
        easing: ease-out;
    }
}

component CustomInputDialog inherits Rectangle {
    // å…¨å±é®ç½©
    width: 100%;
    height: 100%;
    background: #00000060;
    
    // ç‚¹å‡»é®ç½©å…³é—­å¯¹è¯æ¡†
    TouchArea {
        width: parent.width;
        height: parent.height;
        clicked => {
            AppState.hide-custom-input-dialog();
        }
    }
    
    // å±…ä¸­å¯¹è¯æ¡†
    Rectangle {
        width: 300px;
        height: 200px;
        background: white;
        border-radius: 15px;
        drop-shadow-color: #00000030;
        drop-shadow-blur: 20px;
        x: (parent.width - self.width) / 2;
        y: (parent.height - self.height) / 2;
        
        // é˜»æ­¢ç‚¹å‡»å¯¹è¯æ¡†å†…å®¹åŒºåŸŸæ—¶å…³é—­å¯¹è¯æ¡†
        TouchArea {
            width: parent.width;
            height: parent.height;
            clicked => { }
        }
        
        VerticalBox {
            padding: 20px;
            spacing: 15px;
            alignment: center;
            
            Text {
                text: "è¯·è¾“å…¥é¥®æ°´é‡ (ml)";
                font-size: 16px;
                font-weight: 600;
                color: #2c3e50;
                horizontal-alignment: center;
            }
            
            LineEdit {
                height: 40px;
                text: AppState.custom-amount;
                placeholder-text: "ä¾‹å¦‚: 250";
                font-size: 16px;
                input-type: number;
                edited(text) => {
                    AppState.custom-amount = text;
                }
            }
            
            HorizontalBox {
                spacing: 15px;
                alignment: center;
                
                Button {
                    text: "å–æ¶ˆ";
                    width: 80px;
                    clicked => {
                        AppState.hide-custom-input-dialog();
                    }
                }
                
                Button {
                    text: "ç¡®å®š";
                    primary: true;
                    width: 80px;
                    clicked => {
                        AppState.add-custom-water();
                    }
                }
            }
        }
    }
}

// ================================
// ä¸»åº”ç”¨çª—å£
// ================================

export component AppWindow inherits Window {
    title: "ğŸ’§ Water Reminder - å–æ°´æé†’";
    width: 400px;
    height: 600px;
    
    VerticalBox {
        spacing: 0;
        padding: 0;
        
        NavBar {}
        
        // é¡µé¢å†…å®¹åŒºåŸŸ - ä½¿ç”¨Rectangleä½œä¸ºå®¹å™¨æ¥å åŠ é¡µé¢
        Rectangle {
            // é¢„åŠ è½½æ‰€æœ‰é¡µé¢ï¼Œé€šè¿‡å¯è§æ€§æ§åˆ¶æ˜¾ç¤º
            HomePage {
                visible: AppState.current-page == 0;
            }
            
            StatsPage {
                visible: AppState.current-page == 1;
            }
            
            SettingsPage {
                visible: AppState.current-page == 2;
            }
        }
    }
    
    // è‡ªå®šä¹‰è¾“å…¥å¯¹è¯æ¡†
    if AppState.show-custom-input: CustomInputDialog {}
    
    // æˆåŠŸæç¤ºToast
    if AppState.show-success-toast: Rectangle {
        width: root.width;
        height: root.height;
        
        SuccessToast {
            x: (parent.width - self.width) / 2;
            y: 100px;
        }
    }
}